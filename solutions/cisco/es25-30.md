---
title: ES25 - ModC - 30% Solution
description: ES25 - ModC - 30% Solution
published: true
date: 2025-08-23T12:15:07.603Z
tags: es25-cisco, es25
editor: markdown
dateCreated: 2025-06-26T08:57:53.009Z
---

# ES25 30% solution

## NTP

### Time-zone settings

```cisco
clock timezone CET 1 0
clock summer-time CEST recurring last Sun Mar 2:00 last Sun Oct 3:00
```

### Server side config

```cisco
ntp master 5
```

### Client side config

```cisco
ntp server 30.30.30.30
ntp update-calendar
ntp authenticate
ntp authentication-key 1 Passw0rd!
ntp trusted-key 1
```

## PKI Server

### Server side config

```cisco
crypto pki server CA
  database level complete
  no database archive
  grant auto
  cdp-url http://30.30.30.30/cgi-bin/pkiclient.exe?operation=GetCRL
  no shutdown
```

### Client side config

```cisco
crypto pki trustpoint CA
  enrollment url http://30.30.30.30:80
  ip-address x.x.x.x
  serial-number
  revocation-check crl
  rsakeypair VPN 2048
  auto-enroll 90 regenerate
  exit
  
crypto pki authenticate CA

crypto pki enroll CA
```

## Cert DMVPN

You have to do the PKI part first and then use these commands.

### Tunnel interface config

```cisco
interface tunnel 100
	vrf forwarding herningco
  tunnel key 100
  tunnel source loopback0
  tunnel mode gre multipoint
  tunnel protection ipsec profile IPSEC-PROF # If you want to apply IKEv2, and IPSEC rules
  ip nhrp authentication Herning
  ip nhrp network-id 100
  ip nhrp nhs 10.0.0.254 nbma 10.10.10.10 multicast # Just for SPOKE routers
```

### IKEv2, IPSEC config

```cisco
crypto ikev2 proposal IKE-PROP
	group 14
  integrity sha256
  encryption aes-cbc-256
  
crypto ikev2 policy IKE-POL
	proposal IKE-PROP
  match fvrf any
  match address local x.x.x.x
  
crypto pki certificate map CMAP
	issuer-name co CA.isp.denmark
  
crypto ikev2 profile IKE-PROF
	pki trustpoint CA
  match certificate CMAP
  match address local x.x.x.x
  authenticate remote rsa-sig
  authenticate local rsa-sig
  
crypto ipsec transform-set IPSEC-TRANS esp-aes 256 sha-256-hmac
	mode tunnel
  
crypto ipsec profile IPSEC-PROF
	match ikev2 profile IKE-PROF
  match transform-set IPSEC-TRANS
```

### + HUB config

```cisco
no crypto ikev2 http-url cert
```


## EIGRP (vrf)

```cisco
router eigrp EIGRP
	address-family ipv4 vrf herningco autonomous-system 10
  	network x.x.x.x z.z.z.z
```

## HSRP Tracking

```cisco
ip sla 1
	icmp-echo x.x.x.x
  	freq 5

ip sla 2
	icmp-echo y.y.y.y
  	freq 5

ip sla schedudle 1 start-time now life forever
ip sla schedudle 2 start-time now life forever

track 1 ip sla 1
track 2 ip sla 2
track 3 list boolean and
	object 2
  object 3

int vlan 10
	standby 10 track 3 decrement 51
  
int vlan 100
	standby 100 track 3 decrement 51
```

## Configuration management

```cisco
archive
  log config
    logging enable
    notify syslog
  path flash:/config/archived-$t
  maximum 5
  time-period 60

logging host 172.16.100.50
```

## PBR

ACL for **DSW*x***:

```cisco
ip access-list extended VL100-CLOUDSRV
  permit ip 172.16.100.0 0.0.0.255 host 192.168.50.100
```

ACL for **CORE-PE**:

```cisco
ip access-list extended CLOUDSRV-VL100
  permit ip host 192.168.50.100 172.16.100.0 0.0.0.255
```

---

**Create route-map** to match and redirect traffic.

<kbd>DSW</kbd> *(Change 32 to 33 for DSW2)*
```cisco
route-map PBR permit 10
  match ip address VL100-CLOUDSRV
  set ip next-hop 172.16.32.5 172.16.32.6
```

<kbd>CORE-PE</kbd>
```cisco
route-map PBR permit 10
  match ip address CLOUDSRV-VL100
  set ip next-hop 10.0.0.1 10.0.0.2
```

**Apply** the **route-map** for PBR to the correct interface. *(For **CORE-PE**, it is the **uplink to CLOUDFW**, for **DSWx**, it is **SVI 100**)*

```cisco
interface xxx
  ip policy route-map PBR
```

## Remove VRF

```cisco
 _________
< No idea >
 ---------
   \
    \
      _____   _________
     /     \_/         |
    |                 ||
    |                 ||
   |    ###\  /###   | |
   |     0  \/  0    | |
  /|                 | |
 / |        <        |\ \
| /|                 | | |
| |     \_______/   |  | |
| |                 | / /
/||                 /|||
   ----------------|
        | |    | |
        ***    ***
       /___\  /___\
```
