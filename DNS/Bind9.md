---
title: Bind9
description: Bind9 DNS server configuration. DDNS, high availability included.
published: true
date: 2025-02-17T10:57:44.242Z
tags: linux
editor: markdown
dateCreated: 2025-02-15T08:40:05.945Z
---

# Bind9

In this guide there will be Bind9 high availability DNS server configuration.

## Installation

First, you have to install `bind9`, `bind9-utils` packages for using the service.

```
apt install bind9 bind9-utils
```

>The name of the daemon will be named. 
{.is-info}

The config files will be under `/etc/bind/`, but because we will configure DDNS, put the configuration files under `/var/lib/bind/` so the bind user can access and edit this file.

## Set up primary/master server

### Edit configuration files

Add a new file into `/etc/bind/named.conf` where you will describe your zone files.
```conf
...

include "/etc/bind/named.conf.local";
```

Edit the `/etc/bind/named.conf.options` config file. If you will use this for just your LAN create an ACL too from where clients can query.
```conf
acl internal-network {10.0.0.0/24;};

options {
        ...
        
        // Uncomment these lines, and set up a DNS forwarder (Where to send queries when dosn't recognised by it's self zones.)
        forwarders {
                8.8.8.8;
        };

        ...
        
        
        allow-query { internal-network; };
        
        listen-on port 53 { localhost; 10.0.0.1; };
        listen-on-v6 { none; };
};

```

Create the file where you describe your zone files `/etc/bind/named.conf.local`.
```
// Forward lookup zone
zone company.com IN {
        type master;
        file "/var/lib/bind/db.company.com";
        allow-query { internal-network; };
        allow-transfer { 10.0.0.2; }; // Secondary server
        also-notify { 10.0.0.2; };
};

// Reverse lookup zone
zone 0.0.10.in-addr.arpa IN {
        type master;
        file "/var/lib/bind/db.10.0.0";
        allow-query { internal-network; };
        allow-transfer { 10.0.0.2; };
        also-notify { 10.0.0.2; };
};
```

### Edit zone files

Copy `/etc/bind/db.empty` file into the ones below, and edit them for your needs.

Forward lookup zone: `/var/lib/bind/db.company.com`
```
; BIND reverse data file for empty rfc1918 zone
;
; DO NOT EDIT THIS FILE - it is used for multiple zones.
; Instead, copy it, edit named.conf, and use that copy.
;
$TTL    86400
@       IN      SOA     company.com. root.company.com. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                          86400 )       ; Negative Cache TTL
;
@          IN      NS      company.com.
srv1       IN      A       10.0.0.1
srv1       IN      AAAA    2001:db8:aaaa::1
srv2       IN      A       10.0.0.2
web        IN      CNAME   srv1.company.com.

```

Reverse lookup zone: `/var/lib/bind/db.10.0.0`
```
; BIND reverse data file for empty rfc1918 zone
;
; DO NOT EDIT THIS FILE - it is used for multiple zones.
; Instead, copy it, edit named.conf, and use that copy.
;
$TTL    86400
@       IN      SOA     company.com. root.company.com. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                          86400 )       ; Negative Cache TTL
;
@       IN      NS      company.com.
1       IN      PTR     srv1.company.com.
2       IN      PTR     srv2.company.com.


```

## Set up secondary/slave server

On a secondary or slave server you just have to set up the config files and the zone describer file.

Add a new file into `/etc/bind/named.conf` where you will describe your zone files.
```conf
...

include "/etc/bind/named.conf.local";
```

Edit the `/etc/bind/named.conf.options` config file. If you will use this for just your LAN create an ACL too from where clients can query.
```conf
acl internal-network {10.0.0.0/24;};

options {
        ...
        
        // Uncomment these lines, and set up a DNS forwarder (Where to send queries when dosn't recognised by it's self zones.)
        forwarders {
                8.8.8.8;
        };

        ...
        
        allow-query { internal-network; };
        
        listen-on port 53 { localhost; 10.0.0.2; };
        listen-on-v6 { none; };
};

```

Create the file where you describe your zone files `/etc/bind/named.conf.local`.
```
zone esher.com {
        type secondary;
        file "esher.com.lan";
        masters { 10.0.0.1; }; // Primary server
};

zone 0.0.10.in-addr.arpa {
        type secondary;
        file "db.10.0.0";
        masters { 10.0.0.1; }; 
};
```

## Using the DNS server

> If you don't use DHCP than you have to edit `/etc/resolv.conf` on Linux and add these lines (What your DNS servers are)
{.is-info}

```
nameserver 10.0.0.1
nameserver 10.0.0.2
```


## Edit zone files, after setting up the servers

You have to use some commands if you use DDNS (but I recommend you to use this everytime) to edit the file properly.

First you have to freeze the zone.
```
rndc freeze company.com
```

Now you can make the changes in your zone file. 
> After made the changes increment the Serial number!
{.is-warning}

Check that all configs are great. If it says everything is good go ahead, if not resolve the error!
```
named-checkzone company.com /var/lib/company.com.lan
```

Use this command to 'reload' your zone, and restart the daemon.
```
rndc thaw company.com
systemctl restart named
```

## DDNS (DHCP)

Generate a key add it to a new file, so you can use it in other files too.

```
cd /etc/bind
tsig-keygen DHCP-key > DHCP.key
```

Add this to `/etc/bind/named.conf` before including the zone describer file.
```
...

include "/etc/bind/DHCP.key"
include "/etc/bind/named.conf.local"
```

Go to the zone describer file `(/etc/bind/named.conf.local)` and add this line to every zone where you want to add dinamic records from DHCP. Your zone file have to look like this:

```
zone esher.com IN {
        type master;
        file "/var/lib/bind/esher.com.lan";
        allow-query { internal-network; };
        allow-transfer { 10.0.0.2; };
        also-notify { 10.0.0.2; };
        allow-update { key dhcp-key; };
};
```

Restart the daemon.
```
systemctl restart named
```